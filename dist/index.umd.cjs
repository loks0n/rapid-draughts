(function(r,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(r=typeof globalThis<"u"?globalThis:r||self,s(r["rapid-draughts"]={}))})(this,function(r){"use strict";var G=Object.defineProperty;var x=(r,s,T)=>s in r?G(r,s,{enumerable:!0,configurable:!0,writable:!0,value:T}):r[s]=T;var v=(r,s,T)=>(x(r,typeof s!="symbol"?s+"":s,T),T);const s=[];s[0]=1;for(let i=1;i<32;i++)s[i]=s[i-1]*2;const T=4095,E=4293918720,A=0,p=s[1]|s[2]|s[3]|s[9]|s[10]|s[11]|s[17]|s[18]|s[19]|s[25]|s[26]|s[27],l=s[4]|s[5]|s[6]|s[12]|s[13]|s[14]|s[20]|s[21]|s[22],f=s[28]|s[29]|s[30]|s[20]|s[21]|s[22]|s[12]|s[13]|s[14]|s[4]|s[5]|s[6],d=s[25]|s[26]|s[27]|s[17]|s[18]|s[19]|s[9]|s[10]|s[11],O=s[28]|s[29]|s[30]|s[31],B=s[0]|s[1]|s[2]|s[3];function b(i){const t=[];for(let e=0;e<32;e++){const n=i&1<<e;n&&t.push(n)}return t}function P(i){let t=0;for(let e=0;e<32;e++)i&1<<e&&(t+=1);return t}function M(i){for(let t=0;t<32;t++)if(i&1<<t)return`S[${t}]`;return"-"}function w(i){return b(i).map(t=>M(t)).join(" | ")}function S(i){return{origin:M(i.origin),destination:M(i.destination),captures:w(i.captures)}}const y=Object.freeze(Object.defineProperty({__proto__:null,formatBitToMultipleSquares:w,formatBitToSquare:M,formatMove:S,getBitCount:P,getBitSplitArray:b},Symbol.toStringTag,{value:"Module"}));var a=(i=>(i[i.WHITE=0]="WHITE",i[i.BLACK=1]="BLACK",i))(a||{}),m=(i=>(i[i.PLAYING=0]="PLAYING",i[i.BLACK_WON=1]="BLACK_WON",i[i.WHITE_WON=2]="WHITE_WON",i))(m||{});class K{constructor(t=T,e=E,n=A,o=a.WHITE){v(this,"white");v(this,"black");v(this,"king");v(this,"playerToMove");v(this,"noPieces");v(this,"whiteKing");v(this,"blackKing");v(this,"_moves");this.white=t,this.black=e,this.king=n,this.playerToMove=o,this.noPieces=~(this.white|this.black),this.whiteKing=this.white&this.king,this.blackKing=this.black&this.king}move(t){let e=!1;for(const n of this.moves())n.captures===t.captures&&n.destination===t.destination&&n.origin===t.origin&&(e=!0);if(!e)throw new Error("invalid move");return this.playerToMove===a.WHITE?this._moveWhite(t):this._moveBlack(t)}moves(){if(this._moves===void 0){const t=this._getJumpers();if(t)return this._generateJumps(t);const e=this._getMovers();this._moves=this._generateMoves(e)}return this._moves}status(){return this.moves().length===0?this.playerToMove===a.WHITE?m.BLACK_WON:m.WHITE_WON:m.PLAYING}_moveWhite(t){const e=t.origin&this.king;let n=this.white^t.origin,o=this.king^e;const c=this.black^t.captures;return o^=t.captures&this.king,n|=t.destination,o|=e?t.destination:t.destination&O,new K(n,c,o,a.BLACK)}_moveBlack(t){const e=t.origin&this.king;let n=this.black^t.origin,o=this.king^e;const c=this.white^t.captures;return o^=t.captures&this.king,n|=t.destination,o|=e?t.destination:t.destination&B,new K(c,n,o,a.WHITE)}_generateMoves(t){const e=[],n=b(t);for(const o of n)e.push(...this._generateOriginMoves(o));return e}_generateJumps(t){const e=[],n=b(t);for(const o of n){const c=this._generateOriginJumps(o);e.push(...c)}return e}_generateOriginMoves(t){return this.playerToMove===a.WHITE?this._generateOriginMovesWhite(t):this._generateOriginMovesBlack(t)}_generateOriginMovesWhite(t){const e=[],o=t<<4&this.noPieces;o&&e.push({origin:t,destination:o,captures:0});const c=(t&p)<<3&this.noPieces;c&&e.push({origin:t,destination:c,captures:0});const h=(t&l)<<5&this.noPieces;if(h&&e.push({origin:t,destination:h,captures:0}),t&this.whiteKing){const _=t>>4&this.noPieces;_&&e.push({origin:t,destination:_,captures:0});const u=(t&f)>>3&this.noPieces;u&&e.push({origin:t,destination:u,captures:0});const k=(t&d)>>5&this.noPieces;k&&e.push({origin:t,destination:k,captures:0})}return e}_generateOriginMovesBlack(t){const e=[],o=t>>4&this.noPieces;o&&e.push({origin:t,destination:o,captures:0});const c=(t&f)>>3&this.noPieces;c&&e.push({origin:t,destination:c,captures:0});const h=(t&d)>>5&this.noPieces;if(h&&e.push({origin:t,destination:h,captures:0}),t&this.blackKing){const _=t<<4&this.noPieces;_&&e.push({origin:t,destination:_,captures:0});const u=(t&p)<<3&this.noPieces;u&&e.push({origin:t,destination:u,captures:0});const k=(t&l)<<5&this.noPieces;k&&e.push({origin:t,destination:k,captures:0})}return e}_generateOriginJumps(t){const e=this.playerToMove===a.WHITE?this._generateOriginJumpWhite(t):this._generateOriginJumpBlack(t),n=[];for(;e.length>0;){const o=e.pop();if(!o)break;const c=this.playerToMove===a.WHITE?this._generateOriginJumpWhite(o.destination,o.origin&this.king):this._generateOriginJumpBlack(o.destination,o.origin&this.king);c.length>0?e.push(...c.map(h=>({origin:o.origin,destination:h.destination,captures:h.captures|o.captures}))):n.push(o)}return n}_generateOriginJumpWhite(t,e=t&this.whiteKing){const n=[],o=t<<4&this.black,c=((o&p)<<3|(o&l)<<5)&this.noPieces;c&&n.push({origin:t,destination:c,captures:o});const h=((t&p)<<3|(t&l)<<5)&this.black,_=h<<4&this.noPieces;if(_&&n.push({origin:t,destination:_,captures:h}),e){const u=t>>4&this.black,k=((u&f)>>3|(u&d)>>5)&this.noPieces;k&&n.push({origin:t,destination:k,captures:u});const I=((t&f)>>3|(t&d)>>5)&this.black,g=I>>4&this.noPieces;g&&n.push({origin:t,destination:g,captures:I})}return n}_generateOriginJumpBlack(t,e=t&this.blackKing){const n=[],o=t>>4&this.white,c=((o&f)>>3|(o&d)>>5)&this.noPieces;c&&n.push({origin:t,destination:c,captures:o});const h=((t&f)>>3|(t&d)>>5)&this.white,_=h>>4&this.noPieces;if(_&&n.push({origin:t,destination:_,captures:h}),e){const u=t<<4&this.white,k=((u&p)<<3|(u&l)<<5)&this.noPieces;k&&n.push({origin:t,destination:k,captures:u});const I=((t&p)<<3|(t&l)<<5)&this.white,g=I<<4&this.noPieces;g&&n.push({origin:t,destination:g,captures:I})}return n}_getJumpers(){return this.playerToMove===a.WHITE?this._getWhiteJumpers():this._getBlackJumpers()}_getBlackJumpers(){let t=0,e=this.noPieces<<4&this.white;return e&&(t|=((e&p)<<3|(e&l)<<5)&this.black),e=((this.noPieces&p)<<3|(this.noPieces&l)<<5)&this.white,t|=e<<4&this.black,this.blackKing&&(e=this.noPieces>>4&this.white,e&&(t|=((e&f)>>3|(e&d)>>5)&this.blackKing),e=((this.noPieces&f)>>3|(this.noPieces&d)>>5)&this.white,e&&(t|=e>>4&this.blackKing)),t}_getWhiteJumpers(){let t=0,e=this.noPieces>>4&this.black;return e&&(t|=((e&f)>>3|(e&d)>>5)&this.white),e=((this.noPieces&f)>>3|(this.noPieces&d)>>5)&this.black,t|=e>>4&this.white,this.whiteKing&&(e=this.noPieces<<4&this.black,e&&(t|=((e&p)<<3|(e&l)<<5)&this.whiteKing),e=((this.noPieces&p)<<3|(this.noPieces&l)<<5)&this.black,e&&(t|=e<<4&this.whiteKing)),t}_getMovers(){return this.playerToMove===a.WHITE?this._getWhiteMovers():this._getBlackMovers()}_getBlackMovers(){let t=this.noPieces<<4&this.black;return t|=(this.noPieces&p)<<3&this.black,t|=(this.noPieces&l)<<3&this.black,this.blackKing&&(t|=this.noPieces>>4&this.blackKing,t|=(this.noPieces&f)>>3&this.blackKing,t|=(this.noPieces&d)>>5&this.blackKing),t}_getWhiteMovers(){let t=this.noPieces>>4&this.white;return t|=(this.noPieces&f)>>3&this.white,t|=(this.noPieces&d)>>5&this.white,this.whiteKing&&(t|=this.noPieces<<4&this.whiteKing,t|=(this.noPieces&p)<<3&this.whiteKing,t|=(this.noPieces&l)<<3&this.whiteKing),t}}const H={[m.WHITE_WON]:a.WHITE,[m.BLACK_WON]:a.BLACK};function L(i){const t=i.status();return t!==m.PLAYING?i.playerToMove===H[t]?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:J(i)}function J(i){const t=i.playerToMove===a.WHITE?i.white:i.black,e=i.playerToMove===a.WHITE?i.black:i.white;let n=0;return n+=P(t),n+=P(t&i.king),n-=P(e),n-=P(e&i.king),n}function W(i,t,e){const n=L(i);if(n>=e)return e;t=Math.max(n,t);for(const o of i.moves()){if(P(o.captures)===0)continue;const c=i.move(o),h=-W(c,-e,-t);if(h>=e)return e;t=Math.max(h,t)}return t}function j(i,t){let e=Number.NEGATIVE_INFINITY,n;for(const o of i.moves()){const c=i.move(o),h=-N(c,t-1,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);h>=e&&(e=h,n=o)}return n}function N(i,t,e,n){if(t===0||i.status()!==m.PLAYING)return W(i,e,n);for(const o of i.moves()){const c=i.move(o),h=-N(c,t-1,-n,-e);if(h>=n)return n;e=Math.max(h,e)}return e}const C=Object.freeze(Object.defineProperty({__proto__:null,alphaBetaMove:j},Symbol.toStringTag,{value:"Module"}));r.AI=C,r.Draughts=K,r.Helpers=y,r.S=s,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
