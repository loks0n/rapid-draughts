(function(r,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(r=typeof globalThis<"u"?globalThis:r||self,i(r["rapid-draughts"]={}))})(this,function(r){"use strict";var x=Object.defineProperty;var G=(r,i,m)=>i in r?x(r,i,{enumerable:!0,configurable:!0,writable:!0,value:m}):r[i]=m;var v=(r,i,m)=>(G(r,typeof i!="symbol"?i+"":i,m),m);const i=[];i[0]=1;for(let s=1;s<32;s++)i[s]=i[s-1]*2;const m=4095,E=4293918720,O=0,p=i[1]|i[2]|i[3]|i[9]|i[10]|i[11]|i[17]|i[18]|i[19]|i[25]|i[26]|i[27],l=i[4]|i[5]|i[6]|i[12]|i[13]|i[14]|i[20]|i[21]|i[22],f=i[28]|i[29]|i[30]|i[20]|i[21]|i[22]|i[12]|i[13]|i[14]|i[4]|i[5]|i[6],d=i[25]|i[26]|i[27]|i[17]|i[18]|i[19]|i[9]|i[10]|i[11],A=i[28]|i[29]|i[30]|i[31],B=i[0]|i[1]|i[2]|i[3];function b(s){const t=[];for(let e=0;e<32;e++){const n=s&1<<e;n&&t.push(n)}return t}function P(s){let t=0;for(let e=0;e<32;e++)s&1<<e&&(t+=1);return t}function M(s){for(let t=0;t<32;t++)if(s&1<<t)return`S[${t}]`;return"-"}function w(s){return b(s).map(t=>M(t)).join(" | ")}function S(s){return{origin:M(s.origin),destination:M(s.destination),captures:w(s.captures)}}const y=Object.freeze(Object.defineProperty({__proto__:null,formatBitToMultipleSquares:w,formatBitToSquare:M,formatMove:S,getBitCount:P,getBitSplitArray:b},Symbol.toStringTag,{value:"Module"}));var a=(s=>(s[s.WHITE=0]="WHITE",s[s.BLACK=1]="BLACK",s))(a||{}),T=(s=>(s[s.PLAYING=0]="PLAYING",s[s.BLACK_WON=1]="BLACK_WON",s[s.WHITE_WON=2]="WHITE_WON",s))(T||{});class K{constructor(t=m,e=E,n=O,o=a.WHITE){v(this,"white");v(this,"black");v(this,"king");v(this,"playerToMove");v(this,"noPieces");v(this,"whiteKing");v(this,"blackKing");v(this,"_moves");this.white=t,this.black=e,this.king=n,this.playerToMove=o,this.noPieces=~(this.white|this.black),this.whiteKing=this.white&this.king,this.blackKing=this.black&this.king}move(t){let e=!1;for(const n of this.moves())n.captures===t.captures&&n.destination===t.destination&&n.origin===t.origin&&(e=!0);if(!e)throw new Error("invalid move");return this.playerToMove===a.WHITE?this._moveWhite(t):this._moveBlack(t)}moves(){if(this._moves===void 0){const t=this._getJumpers();if(t)return this._generateJumps(t);const e=this._getMovers();this._moves=this._generateMoves(e)}return this._moves}status(){return this.moves().length===0?this.playerToMove===a.WHITE?T.BLACK_WON:T.WHITE_WON:T.PLAYING}_moveWhite(t){const e=t.origin&this.king;let n=this.white^t.origin,o=this.king^e;const c=this.black^t.captures;return o^=t.captures&this.king,n|=t.destination,o|=e?t.destination:t.destination&A,new K(n,c,o,a.BLACK)}_moveBlack(t){const e=t.origin&this.king;let n=this.black^t.origin,o=this.king^e;const c=this.white^t.captures;return o^=t.captures&this.king,n|=t.destination,o|=e?t.destination:t.destination&B,new K(c,n,o,a.WHITE)}_generateMoves(t){const e=[],n=b(t);for(const o of n)e.push(...this._generateOriginMoves(o));return e}_generateJumps(t){const e=[],n=b(t);for(const o of n){const c=this._generateOriginJumps(o);e.push(...c)}return e}_generateOriginMoves(t){return this.playerToMove===a.WHITE?this._generateOriginMovesWhite(t):this._generateOriginMovesBlack(t)}_generateOriginMovesWhite(t){const e=[],o=t<<4&this.noPieces;o&&e.push({origin:t,destination:o,captures:0});const c=(t&p)<<3&this.noPieces;c&&e.push({origin:t,destination:c,captures:0});const h=(t&l)<<5&this.noPieces;if(h&&e.push({origin:t,destination:h,captures:0}),t&this.whiteKing){const _=t>>4&this.noPieces;_&&e.push({origin:t,destination:_,captures:0});const u=(t&f)>>3&this.noPieces;u&&e.push({origin:t,destination:u,captures:0});const k=(t&d)>>5&this.noPieces;k&&e.push({origin:t,destination:k,captures:0})}return e}_generateOriginMovesBlack(t){const e=[],o=t>>4&this.noPieces;o&&e.push({origin:t,destination:o,captures:0});const c=(t&f)>>3&this.noPieces;c&&e.push({origin:t,destination:c,captures:0});const h=(t&d)>>5&this.noPieces;if(h&&e.push({origin:t,destination:h,captures:0}),t&this.blackKing){const _=t<<4&this.noPieces;_&&e.push({origin:t,destination:_,captures:0});const u=(t&p)<<3&this.noPieces;u&&e.push({origin:t,destination:u,captures:0});const k=(t&l)<<5&this.noPieces;k&&e.push({origin:t,destination:k,captures:0})}return e}_generateOriginJumps(t){const e=this.playerToMove===a.WHITE?this._generateOriginJumpWhite(t):this._generateOriginJumpBlack(t),n=[];for(;e.length>0;){const o=e.pop();if(!o)break;const c=this.playerToMove===a.WHITE?this._generateOriginJumpWhite(o.destination,o.origin&this.king):this._generateOriginJumpBlack(o.destination,o.origin&this.king);c.length>0?e.push(...c.map(h=>({origin:o.origin,destination:h.destination,captures:h.captures|o.captures}))):n.push(o)}return n}_generateOriginJumpWhite(t,e=t&this.whiteKing){const n=[],o=t<<4&this.black,c=((o&p)<<3|(o&l)<<5)&this.noPieces;c&&n.push({origin:t,destination:c,captures:o});const h=((t&p)<<3|(t&l)<<5)&this.black,_=h<<4&this.noPieces;if(_&&n.push({origin:t,destination:_,captures:h}),e){const u=t>>4&this.black,k=((u&f)>>3|(u&d)>>5)&this.noPieces;k&&n.push({origin:t,destination:k,captures:u});const g=((t&f)>>3|(t&d)>>5)&this.black,I=g>>4&this.noPieces;I&&n.push({origin:t,destination:I,captures:g})}return n}_generateOriginJumpBlack(t,e=t&this.blackKing){const n=[],o=t>>4&this.white,c=((o&f)>>3|(o&d)>>5)&this.noPieces;c&&n.push({origin:t,destination:c,captures:o});const h=((t&f)>>3|(t&d)>>5)&this.white,_=h>>4&this.noPieces;if(_&&n.push({origin:t,destination:_,captures:h}),e){const u=t<<4&this.white,k=((u&p)<<3|(u&l)<<5)&this.noPieces;k&&n.push({origin:t,destination:k,captures:u});const g=((t&p)<<3|(t&l)<<5)&this.white,I=g<<4&this.noPieces;I&&n.push({origin:t,destination:I,captures:g})}return n}_getJumpers(){return this.playerToMove===a.WHITE?this._getWhiteJumpers():this._getBlackJumpers()}_getBlackJumpers(){let t=0,e=this.noPieces<<4&this.white;return e&&(t|=((e&p)<<3|(e&l)<<5)&this.black),e=((this.noPieces&p)<<3|(this.noPieces&l)<<5)&this.white,t|=e<<4&this.black,this.blackKing&&(e=this.noPieces>>4&this.white,e&&(t|=((e&f)>>3|(e&d)>>5)&this.blackKing),e=((this.noPieces&f)>>3|(this.noPieces&d)>>5)&this.white,e&&(t|=e>>4&this.blackKing)),t}_getWhiteJumpers(){let t=0,e=this.noPieces>>4&this.black;return e&&(t|=((e&f)>>3|(e&d)>>5)&this.white),e=((this.noPieces&f)>>3|(this.noPieces&d)>>5)&this.black,t|=e>>4&this.white,this.whiteKing&&(e=this.noPieces<<4&this.black,e&&(t|=((e&p)<<3|(e&l)<<5)&this.whiteKing),e=((this.noPieces&p)<<3|(this.noPieces&l)<<5)&this.black,e&&(t|=e<<4&this.whiteKing)),t}_getMovers(){return this.playerToMove===a.WHITE?this._getWhiteMovers():this._getBlackMovers()}_getBlackMovers(){let t=this.noPieces<<4&this.black;return t|=(this.noPieces&p)<<3&this.black,t|=(this.noPieces&l)<<3&this.black,this.blackKing&&(t|=this.noPieces>>4&this.blackKing,t|=(this.noPieces&f)>>3&this.blackKing,t|=(this.noPieces&d)>>5&this.blackKing),t}_getWhiteMovers(){let t=this.noPieces>>4&this.white;return t|=(this.noPieces&f)>>3&this.white,t|=(this.noPieces&d)>>5&this.white,this.whiteKing&&(t|=this.noPieces<<4&this.whiteKing,t|=(this.noPieces&p)<<3&this.whiteKing,t|=(this.noPieces&l)<<3&this.whiteKing),t}}const H={[T.WHITE_WON]:a.WHITE,[T.BLACK_WON]:a.BLACK};function J(s){const t=s.status();return t!==T.PLAYING?s.playerToMove===H[t]?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:L(s)}function L(s){const t=s.playerToMove===a.WHITE?s.white:s.black,e=s.playerToMove===a.WHITE?s.black:s.white;let n=0;return n+=P(t),n+=P(t&s.king),n-=P(e),n-=P(e&s.king),n}function W(s,t,e){const n=J(s);if(n>=e)return e;t=Math.max(n,t);for(const o of s.moves()){if(P(o.captures)===0)continue;const c=s.move(o),h=-W(c,-e,-t);if(h>=e)return e;t=Math.max(h,t)}return t}function j(s,t){let e=Number.NEGATIVE_INFINITY,n;for(const o of s.moves()){const c=s.move(o),h=-N(c,t-1,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY);h>=e&&(e=h,n=o)}return n}function N(s,t,e,n){if(t===0)return W(s,e,n);for(const o of s.moves()){const c=s.move(o),h=-N(c,t-1,-n,-e);if(h>=n)return n;e=Math.max(h,e)}return e}const C=Object.freeze(Object.defineProperty({__proto__:null,alphaBetaMove:j},Symbol.toStringTag,{value:"Module"}));r.AI=C,r.Draughts=K,r.Helpers=y,r.S=i,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
